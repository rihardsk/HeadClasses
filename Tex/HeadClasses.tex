\documentclass{llncs}
\usepackage{enumerate}
\usepackage{amssymb,amsmath}
\usepackage{enumitem}
\usepackage{verbatim}

% xelatex
%\usepackage{fontspec}
%\usepackage{xunicode}
%\usepackage{xltxtra}

%valodas. nez, vai vajag
%\usepackage{polyglossia}
%\setdefaultlanguage{english}
%\setotherlanguages{latvian,russian}


\usepackage[numbers]{natbib}

\renewcommand\bibname{\refname} %renames Bibliography -> References

%fixes underscore error in bibliography urls
\usepackage{url}
\let\harvardurl\url

% bibliography
%\usepackage{csquotes}
%\usepackage[
%    backend=biber,
%    style=numeric-comp,
%    sorting=none,
%    natbib=true,
%    url=false,
%    doi=true%,
%    %eprint=false
%]{biblatex}
%\addbibresource{bibliography.bib}


%images
\usepackage{graphicx}
\usepackage{float}

%dalî?ana kolonnâs
\usepackage{multicol}

%papildus matemâtika
\usepackage{mathtools}


\newcommand{\norm}[1]{\left\| #1 \right\|}

\begin{document}

\title{On the Hierarchy Classes of Finite Ultrametric Automata}


\author{
Rihards Kri\v slauks, Kaspars Balodis}
\institute{University of Latvia Faculty of computing,\\ Rai\c na bulv\= aris 19, Riga, LV-1459, Latvia
}

\maketitle
%TODO Freivalda zvaigznisteksts

\begin{abstract}
The work explores the language classes that arise with respect to the head count of a finite automaton. The results for deterministic non-deterministic and probabilistic automata are explored and similar results are proved for two-way ultrametric automata, which are viewed as a generalization of ultrametric finite automata that have just recently been introduced by \citet{Freivalds2012}. For the one-way setting it is shown that ultrametric one-head finite automata are more powerful than deterministic and non-deterministic automata for certain languages. Definitions for ultrametric Turing machines and ultrametric multi-register machines are introduced as a tool for proving the results.
\end{abstract}



\section{Introduction} 
Ultrametric finite automata and Turing machines were first introduced by \citet{Freivalds2012}. This has been followed by several papers where various aspects of them are studied in depth. \citet{ KasparsBalodis2013} have studied the descriptional complexity of ultrametric automata. They show that ultrametric automata can achieve an exponential advantage in terms of the number of states required when compared to equivalent deterministic automata. \citet{Krislauks2013} have studied the reversal complexity of ultrametric Turing machines.

Ultrametric machines are similar to probabilistic machines, the difference being that it is not necessary for amplitudes (which are the equivalent of probabilities in probabilistic automata) to be in the range between 0 and 1. Instead $p$-adic numbers are used. We should note that in \citep{Turakainen1969} a similar generalization of probabilistic automata was introduced, where "probabilities" can be arbitrarily large numbers, and the acceptance criterion is whether the probability to be in an accepting state is greater than a given threshold, furthermore it was shown that this generalization is in fact equivalent to probabilistic automata. However, unlike in these pseudo-probabilistic machines, the definition of ultrametric machines uses the concept of a $p$-adic norm.

It can be argued that the definition introduced by Freivalds is natural because in 1916 Alexander Ostrowski proved that any non-trivial absolute value on the rational numbers $Q$ is equivalent to either the usual real absolute value or a $p$-adic absolute value.
This result shows that using $p$-adic numbers is not merely one of many possibilities to generalize the definition of deterministic algorithms but rather the only remaining possibility not yet explored \citep{Freivalds2012}.
In addition useful properties have been proven for the definition of ultrametric machines -- \citet{KasparsBalodis2013} proved that the language class recognized by regulated $p$-adic machines coincides with the class of regular languages.

In this paper we address the question of the language hierarchy associated with the number of heads of ultrametric multi-head automata.
Several results can be found in the literature which consider deterministic, nondeterministic and probabilistic finite automata in both -- the two-way and one-way -- cases \citep{Holzer2009, Yao1978, Monien1980, Macarie1995}. The paper examines whether similar results regarding the separation in classes with respect to the head count can be achieved for ultrametric multi-head finite automata. Other results consider the relationships of the language classes recognized by ultrametric and classical automata.

\section{$p$-adic numbers}
\subsection{Introduction to $p$-adic numbers}
A $p$-adic digit is a natural number in the range of $0$ to $p-1$ (inclusive) where by $p$ we denote an arbitrary prime number. A $p$-adic integer is a sequence
$(a_i)_{i \in \mathbb{N}}$ where each $a_i$ is a $p$-adic digit. This is the same as $\cdots a_i \cdots a_2a_1a_0$.
Which corresponds to a natural number given by
\[
\sum\limits_{i=0}^{+\infty}a_ip^i,
\]
where $p$ is our chosen prime number. This sequence is infinite to the left side. Furthermore - a natural number represented in $p$-adic numbers will have only a finite number of non-zero digits. For any given $n \in \mathbb{N}$ the non-zero part of its representation in $p$-adic numbers will exactly match $n$ representation in base $p$. Take the number $42$ as an example which is written as $132$ in base $5$. Its $5$-adic representation is $\cdots 0 \cdots 0132$.

The situation is different for negative and rational $p$-adic numbers. Take the number $\frac{1}{2}$ and its $5$-adic representation as an example. $5$-adic $\frac{1}{2}$ is a number which added to itself gives $1$. From this we can devise that the $5$-adic representation of $1$ is  
\[
\begin{tabular}{rrrrrrrrr|}
&$\cdots$ &2 &2 &2 &2 &2 &3\\
+&$\cdots$ &2 &2 &2 &2 &2 &3\\
\hline
\hline
&$\cdots$ &0 &0 &0 &0 &0 &1\\
\hline
\end{tabular}
\]

Similarly we devise subtraction and negative numbers. For example in $5$-adics
\[
\begin{tabular}{rrrrrrrrr|}
&$\cdots$ &0 &0 &0 &1 &3 &2\\
-&$\cdots$ &0 &0 &0 &2 &3 &4\\
\hline
\hline
&$\cdots$ &4 &4 &4 &3 &4 &3\\
\hline
\end{tabular}
\]
%Turklât var ievçrot, ka arî negatîviem skaitïiem informâciju satur tikai galîgs skaits ciparu pozîciju. Pozîcijâs, kas ir pietiekami tâlu pa kreisi atkârtojas cipars $p-1$.

Interestingly almost all rational numbers can be expressed as $p$-adic integers. The exceptions for a given $p$ are the numbers of the form $\frac{a}{b}$  where $a$ is not divisible by $p$ but $b$ is divisible by $p$.

Numbers that can't be expressed as $p$-adic natural numbers can however be expressed as $p$-adic rational numbers. Take the number $\frac{1}{5}$ as an example. It can't be expressed in $5$-adic natural numbers but it can be expressed as a $5$-adic rational number
\[
\cdots 0 \cdots 000,1.
\]
We can note that as with $p$-adic natural numbers $p$-adic rational numbers are expressed as a sequence which is infinite to the left side and finite to the right.

All of the usual arithmetic operations can be carried out on $p$-adic numbers as well, namely -- addition, subtraction, multiplication and division. Addition, subtraction and multiplication can be carried out in $p$-adic integers
but the results of subtraction can be general $p$-adic numbers.

It is obvious that for every $q \in \mathbb{Q}$ there exists a prime number $p$ such that $q$ can be expressed as a $p$-adic number. The same does not hold for real numbers. For every $p$ there exists an irrational number such that it cannot be expressed as a $p$-adic number. However that does not imply that for some $p$ $p$-adic numbers are a subset of real numbers. For every $p$ there is a continuum of $p$-adic numbers that cannot be expressed as a real number \citep{Freivalds2012}.

The field of $p$-adic numbers is denoted as $\mathbb{Q}_p$.

\subsection{$p$-adic absolute values}
A function $d: X \times X \rightarrow R_{\geq 0}$ where $X$ is a non-empty set is called a metric iff it satisfies the following conditions:
\begin{enumerate}
\item $d(x,y) = 0$ iff $x = y$,
\item $d(x,y) = d(y,x)$,
\item $d(x,y) \leq d(x,z) + d(z,y)$ for all $z \in X$.
\end{enumerate}

If the set $X$ is equipped with the addition and multiplication operations (and forms a vector space) then a notion of norm can be introduced.
The metric function is used to find the distances among the elements of a set. The distance of a given element to zero $d(x,0)$ is called the elements norm or absolute value and is denoted by $||x||$.

The norm of an element satisfies the following properties:
\begin{enumerate}
\item $||x||=0$ if and only if $x=0$,
\item $||x*y|| = ||x||*||y||$,
\item $||x+y|| \leq ||x||+||y||$ (the triangle inequality).
\end{enumerate}
If the third property can be replaced by its stronger variant - the strong triangle inequality $||x+y|| \leq max(||x||,||y||)$, the norm is called ultrametric. Otherwise, it is called Archimedean. \cite{Freivalds2012}

For every non-zero rational number $\alpha$ there exists a unique prime factorization - $\alpha = \pm 2^{\alpha_2}3^{\alpha_3}5^{\alpha_5}7^{\alpha_7} \cdots$ where $\alpha_i$ are integers, only a finite number of which are non-zero.
\begin{definition}
 The $p$-adic absolute value (also called the \textbf{$p$-norm}) of a rational number $\alpha$ is 
\[
||\alpha||_p = \begin{cases}
p^{-\alpha_p}, &\textrm{if } \alpha \neq 0 \\
0, &\textrm{if } \alpha = 0.
\end{cases}
\]
\end{definition}

$p$-adic numbers in more detail are discussed in \citep{Madore}. The use of $p$-adics in other sciences can be seen in \citep{Kozyrev2006,Dragovich2009}.
%vecaa atsauce \citep{V.S.Vladimirov1995,Kozyrev2006,Dragovich2009}.

\section{One-way multi-head automata}
\subsection{Definitions}
Ultrametric automata are defined as in \citep{KasparsBalodis2013}.
\begin{definition}
A finite one-way $p$-ultrametric automata ($1u_pfa$) is a sextuple
$\langle S, \Sigma, s_0, \delta, F, \Lambda \rangle$ where
\begin{itemize}
  \item $S$ is a finite set -- the set of states,
  \item $\Sigma$ is a finite set ($\$ \notin \Sigma$) -- input alphabet,
  \item $s_0:S \rightarrow \mathbb{Q}_p$ is the initial amplitude distribution,
  \item $\delta: \left( \Sigma \cup \left\{ \$ \right\} \right) \times S \times S \rightarrow \mathbb{Q}_p$ is the transition function,
  \item $F \subseteq S$ is the set of final states,
  \item $\Lambda = \left( \lambda, \diamond \right)$ is the acceptance condition where $\lambda \in \mathbb{R}$ is the acceptance threshold and $\diamond \in \left\{ \leq, \geq \right\}$.
\end{itemize}
The automaton works as follows.
At every timestep each of its states has an associated $p$-adic number called its amplitude.
The automaton starts with the initial amplitude distribution $s_0$.
Then it proceeds by processing input word's $w = w_1 \ldots w_n$ symbols one by one.
The amplitude distribution after processing the $i$-th symbol is denoted as $s_i$, with
$s_i(y) = \sum_{x \in S}{s_{i-1}(x) \cdot \delta \left( w_i, x, y \right) }$ for every $y \in S$.
After the $n$-th symbol, in the same way the end marker $\$$ is processed obtaining the final amplitude distribution $s_{n+1}$.
If the sum of the $p$-norms of final amplitudes over final states is at least (or at most) the threshold, i.e., if $\sum_{x \in F}{\left| s_{n+1}(x) \right|_p} \diamond \lambda$, then the word $w$ is said to be accepted, otherwise -- rejected.
\end{definition}

%TODO ?o nevajag citâ nodaïâ?
A two-way $k$-head (where $k\geq 1$) finite automaton consists of an input tape containing the input word on which the heads of the automaton can move freely in both directions not crossing the endmarkers. The tape is read-only. More formally:
\begin{definition}[\citep{Holzer2009}]
A two-way non-deterministic $k$-head finite automaton ($2nfa(k)$) is a sextuple $\langle S, \Sigma, k, s_0, \delta, F \rangle$, where
\begin{itemize}
	\item $S$ a finite set -- the set of states,
	\item $\Sigma$ is a finite set ($ \triangleright,\triangleleft \notin \Sigma$) -- the input alphabet,
	\item $k\geq 1$ is the number of heads, 
	\item $s_0\in S$ is the starting state,
	\item $\delta: \left( \Sigma \cup \left\{ \triangleright, \triangleleft \right\} \right)^k \times S \times S \rightarrow \left\{-1,0,1\right\}^k$ is a transition function where $\triangleright$ and $\triangleleft$ are the start and end markers,
	\item $F \subseteq S$ is the set of accepting states.
\end{itemize}
\end{definition}
At the beginning of work a $2nfa(k)$ has all of its heads placed on the start marker. The automaton ends its work when the transition function $\delta$ is not defined for the current configuration. A configuration of a $2nfa(k)$ in some time moment $t\geq 0$ is a 3-tuple $c_t=\left(w,s,p\right)$ where $w$ is the input word, $s\in S$ is the current state and
$p = \left( p_1, \ldots, p_k \right) \in \left\{ 0, \ldots, |w| +1 \right\}^k $
gives the current head positions. A transition from one configuration to the next is denoted by $\vdash$. A transition
$\left( w, s, \left( p_1, \ldots, p_k \right) \right) \vdash \left( w, s', \left( p_1+d_1, \ldots, p_k+d_k \right) \right)$
is valid iff
$\left(d_1, \ldots, d_k \right) \in \delta \left( \left( a_{p_1}, \ldots a_{p_k} \right) s, s' \right)$
where $w = a_1a_2 \ldots a_n$ is the input word and $a_0=\triangleright$ and $a_{n+1}=\triangleleft$. $\vdash$ reflexive transitive closure
is denoted by $\vdash^*$.

The language $L(M)$ accepted by $M$ consists of those and only those words which are accepted by $M$. A $2nfa(k)$ accepts a word $w$ iff there exists a sequence of configurations that leads to automaton stopping in an accepting state if the input tape contains
$\triangleright w \triangleleft$. More precisely -- 
\begin{multline*}
	L(M)=\left\{ w \in \Sigma^* | \left(w,s_0,\left(1,\ldots,1\right)\right) \vdash^* \left(w,s,\left(p_1,\ldots,p_k\right)\right), s \in F,\right.\\
	\left.\textrm{and } M \textrm{ stops } \left(w,s,\left(p_1,\ldots,p_k\right)\right)\right\}.
\end{multline*}
If for any state the transition function $\delta$ assigns at most $1$ successor state 
then the automaton is said to be deterministic ($2dfa(k)$). If at any given moment the heads of an automaton move only right (or don't move) then the automaton is one-way. Nondeterministic and deterministic one-way $k$-head automata are denoted by $1nfa(k)$ and $1dfa(k)$ respectively.
%TODO pabeigt par 2DFA(k). <-todo no bak darba


\subsection{Relation to classical automata}
Strictly inclusive classes have been shown for both one-way multi-head deterministic and nondeterministic automata with regard to the head count of the automata \citep{Holzer2009,Yao1978}. In 1978 \citet{Yao1978} showed that in order to separate the class of languages that can be recognized by a $1dfa(k)$ from that which can be recognized by a $1dfa(k+1)$ it is sufficient to use the language
\[
	L_n = \left\{w_1\$w_2\$ \ldots \$w_{2n} | w_i \in \left\{a,b\right\}^* \textrm{ un } w_i = w_{2n+1?i} \textrm{ visiem } 1 \leq i \leq n \right\}.
\]
We will consider a similar language -- $L_k$.
\begin{theorem}
For every $k \geq 1 \in \mathbb{N}$ there exists a language $L_k$ such that:
\begin{enumerate}[label={(\arabic*)}]
	\item for every prime $p$ there exists a $1u_pfa(1)$ that recognizes $L_k$,
	\item $L_k$ cannot be recognized by any $1dfa(k)$,
	\item $L_k$ cannot be recognized by any $1nfa(k)$.
\end{enumerate}
\end{theorem}
\begin{proof} The sought language is
\[
L_k = \left\{ w_1 1 w_2 1 \ldots 1 w_{2n} |
		w_i \in \left\{ 0 \right\}^m \wedge
		m \geq 1 \in \mathbb{N} \wedge
		w_i = w_{2n-i+1} \wedge
		n={k\choose 2}+1 \right\}.
\]
Now we prove that $L_k$ satisfies the points of our theorem.

$(1)$ We show that for an arbitrary language $L_k$ a $1u_pfa(1)$ can be built for every prime number $p$. The automaton starts its in $n$ different starting states $q_{1,1,1},q_{1,2,1},\ldots,q_{1,n,1}$ with amplitude $1$. Each of these states starts a "branch" that is intended for accumulating amplitude in one of $n$ different accepting states $q_{2n,1,2},q_{2n,2,2},\ldots,q_{2n,n,2}$. Every branch contains two kinds of states -- states of the 1st group $q_{i,j,1}$ are responsible for generating amplitudes and states of the 2nd group $q_{i,j,2}$ are intended for amplitude accumulation, $i \in \left[1, 2n \right], j \in \left[1, n \right]$.

If $0$ is read from the input and the automaton is in one of the 1st group states $q_{i,j,1}$ where $i \leq n$ then the amplitude of the state stays the same and with amplitude $1$ the automaton goes to a 2nd group state $q_{i,j,2}$. By doing so the states accumulated amplitude is added to $q_{i,j,2}$. If $0$ is read in a 2nd group state $q_{i,j,2}$ the states amplitude stays the same. If $1$ is read in a 1st group state $q_{i,j,1}$ where $i < n$ then the automaton with amplitude $j + 1$ transitions to $q_{i + 1,j,1}$ thereby transiting there with amplitude $(j + 1) \cdot \left| q_{i + 1,j,1} \right|$ (by $|q_i|$ we denote the amplitude the state $q_i$).
Whereas if $0$ is read in 1st group state $q_{i,j,1}$ where $i > n$ the amplitude of the state is kept unchanged and the transition to $q_{i,j,2}$ is made with amplitude $-1$. If $1$ is read in 1st group state $q_{i,j,1}$ where $i \geq n$ the transition to $q_{i + 1,j,1}$ is made with amplitude $-(j + 1)$. If $1$ is read in a 2nd group state a transition is made from $q_{i,j,1}$ to $q_{i + 1,j,1}$ with amplitude $1$. The exception is the last column of states -- $q_{2n,j,1}$ and $q_{2n,j,2}$ -- since they are responsible for reading in the last block of the word then the transition if $1$ is read is not defined. A schematic representation of the described automaton can be seen in Fig. \ref{fig:1pfa}.

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth]{Img/1pfa.pdf}
\caption{Automaton for recognizing $0^n10^m10^h1 \cdots 10^h10^m10^n$.}
\label{fig:1pfa}
\end{figure}

In result if a word $0^{a_1}10^{a_2}10^{a_3}1\ldots 10^{a_{2n}}$ was read then each of the accepting states $q_{2n,j,2}$ has accumulated an amplitude equal to
\[
	a_1 + a_2 \cdot (j + 1) + a_3 \cdot (j + 1)^2 + \cdots + a_n \cdot (j + 1)^{n - 1} - a_{n+1} \cdot (j + 1)^{n - 1} - a_{n+2} \cdot (j + 1)^{n - 2} - \cdots - a_{2n},
\]
which is equal to $0$ if the word belongs to the language; i.e. if
\[
	a_1 = a_{2n} \wedge a_2 = a_{2n-1} \wedge \ldots \wedge a_n = a_{n+1}.
\]
It follows that a word belongs to the language $L_k$ iff the following equations hold:
\begin{gather*}
\allowdisplaybreaks
	\begin{cases}
		a_1 + a_2 \cdot 2 + a_3 \cdot 2^2 + \cdots + a_n \cdot 2^{n - 1} - a_{n+1} \cdot 2^{n - 1} - a_{n+2} \cdot 2^{n - 2} - \cdots - a_{2n} = 0 \\
		a_1 + a_2 \cdot 3 + a_3 \cdot 3^2 + \cdots + a_n \cdot 3^{n - 1} - a_{n+1} \cdot 3^{n - 1} - a_{n+2} \cdot 3^{n - 2} - \cdots - a_{2n} = 0\\
		a_1 + a_2 \cdot 4 + a_3 \cdot 4^2 + \cdots + a_n \cdot 4^{n - 1} - a_{n+1} \cdot 4^{n - 1} - a_{n+2} \cdot 4^{n - 2} - \cdots - a_{2n} = 0\\
		\cdots \\
		\begin{split}
		a_1 + a_2 \cdot (n + 1) + a_3 \cdot (n + 1)^2 + \cdots + a_n \cdot (n + 1)^{n - 1} - a_{n+1} \cdot (n + 1)^{n - 1} \\
		\qquad- a_{n+2} \cdot (n + 1)^{n - 2} - \cdots - a_{2n} = 0\\
		\end{split}
	\end{cases}\\
\intertext{rewriting}
	\begin{cases}
		(a_1 - a_{2n}) + 2 \cdot (a_2 - a_{2n-1}) + 2^2 \cdot (a_3 - a_{2n-2}) + \cdots + 2^{n - 1} \cdot (a_n - a_{n+1}) = 0\\
		(a_1 - a_{2n}) + 3 \cdot (a_2 - a_{2n-1}) + 3^2 \cdot (a_3 - a_{2n-2}) + \cdots + 3^{n - 1} \cdot (a_n - a_{n+1}) = 0\\
		(a_1 - a_{2n}) + 4 \cdot (a_2 - a_{2n-1}) + 4^2 \cdot (a_3 - a_{2n-2}) + \cdots + 4^{n - 1} \cdot (a_n - a_{n+1}) = 0\\
		\cdots \\
		\begin{split}
		(a_1 - a_{2n}) + (n + 1) \cdot (a_2 - a_{2n-1}) + (n + 1)^2 \cdot (a_3 - a_{2n-2}) + \cdots \\
		\qquad+ (n + 1)^{n - 1} \cdot (a_n - a_{n+1}) = 0\\
		\end{split}	
	\end{cases}
\end{gather*}

We see that the coefficients of the system form a Vandermonde matrix therefore its determinant is non-zero and since the given system is homogeneous only the trivial solution exists.

However if the word does not belong to $L_k$ then some no more than $4$ lines can hold true but even then there will be at least one line which is not equal to $0$. %(citâdi bûtu nenulles risinâjums, un sistçmai bûtu netriviâls atrisinâjums)
Therefore we can choose $0$ as a threshold for the acceptance condition -- we say that a word belongs to $L_k$ iff the accepting state end amplitude norm sum is $\leq 0$ and it does not belong to the language if contrary.

$(2)$ Proven by \citet{Freivalds1979}, a proof for a similar language can also be found in \citep{Yao1978}. The idea of the proof relies on the fact that, any two heads that have been used to compare a pair cannot be used to compare another pair. This implies that if the number of block pairs in a word $n$ is greater than the number of pairs of heads ${k\choose 2}$ then the language cannot be recognized with $k$ heads.

$(3)$ Proven by \citet{Freivalds1979},a proof for a similar language can be found in \citep{Yao1978}. \qed
\end{proof}

%  nâkamais lieki tçrç vietu?
% It should be noted that to recognize $L_k$ a constant number of heads is enough for a probabilistic automaton as well. \citet{Freivalds1982} has proved that for every $\epsilon > 0$ there exists a $1pfa$ that accepts every word in $L_k$ with probability $1$ and rejects others with probability $1 - \epsilon$.

% \section{One-way multi-head automata}
% nebûs

\section{Two-way automata}
\subsection{Definitions}
Ultrametric multi-head automata are defined by generalizing \citep{KasparsBalodis2013} definition of ultrametric automata in a natural way. The definition of multi-head automata due by \citet{Holzer2009} is used as well.

\begin{definition}
A finite $k$-head two-way $p$-ultrametric automaton ($2u_pfa(k)$) is a septuple $\langle S, \Sigma, k, s_0, \delta, F, \Lambda \rangle$ where
\begin{itemize}
	\item $S$ a finite set of states,
	\item $\Sigma$ a finite set ($ \triangleright,\triangleleft \notin \Sigma$) -- input alphabet,
	\item $k\geq 1$ the number of heads, 
	\item $s_0:S \rightarrow \mathbb{Q}_p$ the initial distribution of amplitudes,
	\item $\delta: \left( \Sigma \cup \left\{ \triangleright, \triangleleft \right\} \right)^k \times S \times S \rightarrow \mathbb{Q}_p \times \left\{-1,0,1\right\}^k$ the transition function where $\triangleright$ and $\triangleleft$ are the start and end markers,
	\item $F \subseteq S$ is the set of accepting states,
	\item $\Lambda = \left( \lambda, \diamond \right)$ the acceptance condition where $\lambda \in \mathbb{R}$ is the acceptance threshold and $\diamond \in \left\{ \leq, \geq \right\}$.
\end{itemize}
\end{definition}

$2u_pfa(k)$ works in a similar way as $2u_pfa$ with the exception that the automaton now has $k$ heads which can move freely similarly as in a $2nfa(k)$. In difference from a $2u_pfa$ now amplitudes are given for a pair consisting of the positions of the heads and a state. The amplitude of the state $y \in S$ with heads in positions
$\left( p_1, \ldots, p_k \right) \in \left\{ 0, \ldots, |w| +1 \right\}^k $
after the $i$-th operation is given by
\[
s_i (y, (p_1, \ldots, p_k)) =
\sum_{\mathclap{\substack{ x \in S \wedge \\
		\exists (p'_1, \ldots, p'_k):
		(p'_1, \ldots, p'_k) +
		\delta ((w_{p'_1}, \ldots, w_{p'_k}), x, y)_2 =
		(p_1, \ldots, p_k)}}}
	{s_{i-1}(x) \cdot \delta ((w_{p'_1}, \ldots, w_{p'_k}), x, y)_1 }
\]

\vspace{-2mm}
Similarly as before the acceptance condition is applied to the final amplitude $p$-norm sum of the accepting states. That is, if
\[
\sum_{\mathclap{\substack{x \in F \wedge\\
		\exists (p_1, \ldots, p_k):
		\textrm{ the automaton finishes in the state } x
		\textrm{ with the heads in positions } (p_1, \ldots, p_k) }}}
	{\left| s_{n+1}(x, (p_1, \ldots, p_k)) \right|_p} \diamond \lambda
\]
then we say that $w$ belongs to the language, otherwise it does not.

The class of languages recognized by $2u_pfa(k)$ is denoted $2U_pFA(k)$.

Ultrametric Turing machines are defined to be used as a device to help prove results regarding multi-head automata classes. The basis for the definition is a definition for Turing machine by \citet{Hopcroft1979}. We define a multi-tape Turing machine.
\begin{definition}
A $p$-ultrametric Turing machine with $k$ work tapes ($u_ptm(k)$ or simply $u_ptm$) is a septuple $M= \langle Q, \Sigma, b, \Sigma, \delta, q_0, F \rangle$ where:
\begin{itemize}
	\item $Q$ is a nonempty set of states,
	\item $\Sigma$ is a nonempty set -- the working alphabet,
	\item $b \in \Sigma$ the "empty" symbol,
	\item $\Sigma\subseteq\Sigma\setminus\{b\}$ the input alphabet,
	\item $q_0 : Q \rightarrow \mathbb{Q}_p$ is the initial amplitude distribution,
	\item $F \subseteq Q$ is the accepting state set,
	\item $\delta: Q \setminus F \times \Sigma^k \rightarrow Q \times \left(\Sigma \times \{L,N,R\} \times \mathbb{Q}_p \right)^k$ is a partially defined transition function where $L$ denotes moving the head to the left, $R$ -- to the right and $N$ -- not moving the head and $\mathbb{Q}_p$ is the amplitude with which the transition is made.
\end{itemize}
\end{definition}

The class of languages recognized by a $u_ptm$ is denoted $U_pTM$.

Similarly as with ultrametric multi-head automata the machine with a given amplitude is in one of its possible configurations. However now the configuration consists of state of the finite control and the contents of all $k$ tapes. The amplitude with which the machine is in one of its configurations in the $i$-th step is computed analogously than in the case with ultrametric multi-head automata. From now on when saying that a Turing machine accepts a word we mean that the machine stops in an accepting state after it is done processing the word as input. The criteria for acceptance are analogous to those of ultrametric multi-head automata.
%(jâievçro tikai, ka tagad automâta konfigurâcijâ ietilpst arî no lentes saturs, un amplitûda tiek piekârtota tam kombinâcijâ ar vadîbas bloka stâvokli).

Ultrametric multi-register automata are also used as an intermediate device for proofs.
\begin{definition}
A finite $p$-ultrametric $k$ register automaton (also machine) ($2u_pra(k)$) consists of a $p$-ultrametric finite control and $k$ registers that can hold natural numbers. The automaton begins with the input number in the first register and according to the specified amplitude distribution in some of its states. A predicate $\stackrel{?}{=} 0$ and the operations $+1$ or $-1$ can be applied to a register. Each of the transitions of the finite control can have a predicate or an operation associated with it which is triggered when the transition is made. Acceptance criteria are analogous to those of ultrametric automata.
\end{definition}



\subsection{Simulation of ultrametric automata by ultrametric Turing machines}

In this subsection we will show how to simulate an ultrametric multi-head automaton by an ultrametric Turing machine.
The techniques used here are similar to the techniques used by \citet{Macarie1995} for probabilistic automata.

Without loss of generality we can assume that the simulated automaton has at most $2$ transitions from each state and input symbol.
We will show how to construct a $p$-ultrametric $2$-tape Turing machine which receiving the description of a $k$-head $p$-ultrametric automaton as an input will accept exactly the same words as the automaton.
We will only consider the simulation of automata working in unary alphabet therefore we will show how to encode the description of the automaton in unary alphabet, namely as a word in the form $1^{2^n}, n \in \mathbb{N}$.
Furthermore we will require that the amplitudes of the simulated automaton are $p$-constructible sets.


\begin{definition}
A set $S$ of $p$-adic numbers is $p$-constructible if there exists a $p$-ultrametric Turing machine which receiving a description of a number $x \in S$ as an input reaches a marked state $q_u$ with amplitude $x$.
\end{definition}
%TODO aprakstam nebûtu jâbût ar kkâdu ierobeþotu garumu? citâdi ?íiet, ka nav jçgas no log-space sareþìîtîbas

% Teorçma par racionâliem skaitïiem nebûs
%\begin{theorem}
%The set of rational numbers is $log$-space $p$-constructible.
%\end{theorem}
%\begin{proof}
%The description of a rational number $a$ is given as
%\[
%	\triangleright a_n a_{n-1} \cdots a_1 \cdot a_0 | a_{-1} a_{-2} \cdots a_{-m} \triangleleft,
%\]
%where $|$ is a delimiting symbol, $a_i \in \{0, 1\}$ and 
%\[ %
%	a = \sum\limits_{i=-m}^n a_i \cdot 2^i
%\]
%The machine 
%\qed
%\end{proof}

A $2u_pfa(k)$ can be described with a binary sequence denoting in turn:
%\begin{itemize}
	%\item
	 the number of states,
	%\item
	 the number of heads,
	%\item
	 the transitions between the states and their respective amplitudes.
%\end{itemize}

The simulation is performed as follows.
The $2u_pfa(k)$ $\mathcal{A}$ with transitions from a $p$-constructible set is simulated by a $u_ptm(k)$ $\mathcal{T}$.
$\mathcal{T}$ receives the description of $\mathcal{A}$ in unary alphabet as a word in the form $1^{2^n}, n \in \mathbb{N}$.
$\mathcal{T}$ starts by reading the input word and deterministically making transitions with amplitude $1$ writes $n$ in binary on the second tape where $n$ is the description of the automaton $\mathcal{A}$.
Additionally a space of size $O(k \cdot n)$ is reserved for $k$ counters denoting the positions of the heads of the automaton $\mathcal{A}$.
For the further simulation only the second tape will be used (for convenience we will call it the work tape).

While processing the input word the automaton $\mathcal{A}$ can be in different configurations in parallel with different amplitudes.
If $\mathcal{A}$ is in a configuration with an amplitude $a$, $\mathcal{T}$ will simulate it by being with the same amplitude $a$ in a configuration where the content of the work tape corresponds to the respective configuration of $\mathcal{A}$.

To show that $\mathcal{T}$ can simulate $\mathcal{A}$ in such a way, we must show that every transition of $\mathcal{A}$ can be realized by $\mathcal{T}$.
If $\mathcal{A}$ has a transition from $q_1$ to $q_2$ with an amplitude $a_1$ and from $q_1$ to $q_3$ with an amplitude $a_2$ then $\mathcal{T}$ being in a configuration corresponding to $q_1$ can make transitions to configurations corresponding to $q_2$ and $q_3$ with amplitudes $a_1$ and $a_2$ respectively.
It is done by $\mathcal{T}$ branching and in both cases with an amplitude $1$ writing on a special place on the tape $d_1$ or $d_2$ where $d_1$ and $d_2$ are the descriptions of the transitions and the amplitudes $a_1$ and $a_2$ respectively.
It is done deterministically with amplitude $1$.
Then a subroutine is called which transitions to a marked state $q_u$ with an amplitude $a_1$ or $a_2$ (as all the transitions of $\mathcal{A}$ are $p$-constructible, there exists such subroutine).
After that $\mathcal{T}$ changes the work tape so that it corresponds to the respective transition (again this is done deterministically with amplitude $1$).
As the only transition that is done with an amplitude other than $1$ is the one from the state $q_u$, after this procedure $\mathcal{T}$ is in a configuration corresponding to $q_2$ with amplitude $a_1$ and in a configuration $q_3$ with amplitude $a_2$.





\subsection{Multi-head automata}
\citet{Monien1980} has proven that for finite deterministic and nondeterministic automata the language class that can be recognized using $k$ heads is a proper subclass to the class of languages that can be recognized if $k+1$ heads are allowed. Using similar methods \citet{Macarie1995} has proven the same for finite probabilistic automata. We prove that the same holds for finite ultrametric automata.

\begin{definition}
By $\widehat{C}$ we denote the subset of a language class $C$ containing only the words in the form $1^{2^n}, n \in \mathbb{N}$, more precisely -- $\widehat{C} = \left\{ h | h \in C \wedge \exists n \in \mathbb{N} : h = 1^{2^n} \right\}$\\
\end{definition}
\begin{theorem} \label{atdalisana}
For every natural number $k$ and prime $p$
\[
	\widehat{2U_pFA(k)} \subsetneqq \widehat{U_pTM}.
\]
\end{theorem}
\begin{proof}
We will construct a special $p$-ultrametric Turing machine with 2 tapes and $log$-space space complexity called $\mathcal{T}$. We will show that its recognized language cannot be recognized by a $p$-ultrametric automata with $k$ heads for any $k$.

Similarly as in the previous section
we will construct $\mathcal{T}$ so that it simulates a $2u_pfa(k)$ given in its input called $\mathcal{A}$. Contrary than before $\mathcal{A}$ "definition" does not directly include the input for $\mathcal{A}$. We will run $\mathcal{A}$ on the input string, i.e. on its "definition", instead.

More precisely -- $\mathcal{T}$ 1st tape contains $1^m, m \in \mathbb{N}$, $\mathcal{T}$ checks whether it's in the form $1^{2^n}, n \in \mathbb{N}$ (rejecting the word if not) and by taking up $O(log(n))$ space writes $n$'s binary representation on the 2nd tape (we will call it the work tape). Then it checks whether $n$'s binary representation is syntactically a valid $2u_pfa(k)$; the word is rejected if not. Then $\mathcal{T}$ designates a space on the work tape to be used for $k$ counters that will be used to represent $\mathcal{A}$'s head positions. Since the counter values can be in $\left[0, \ldots, 1^{2^n} \right]$ $O(k \cdot log(2^n)) \sim O(k \cdot n)$ space is required.
All previous actions are done deterministically making transitions with amplitude $1$. Next $\mathcal{T}$ is run on the input string similarly as it is shown in the previous section (1st tapes head is not used anymore, it is checked whether or not the counters corresponding to head positions are inside word boundaries). Consequently $\mathcal{T}$ is with respective amplitudes in all of the possible configurations in which $\mathcal{A}$ could have been after processing the word. Afterwards $\mathcal{T}$ looks whether the contents of the work tape suggest that $\mathcal{A}$ is in an accepting state and the word is rejected if $\mathcal{A}$ would have accepted it and it is accepted if $\mathcal{A}$ would have rejected it. Therefore $\mathcal{T}$ gives the opposite result to that of $\mathcal{A}$ with the same amplitudes.

Let us consider the language $L(\mathcal{T})$ recognized by $\mathcal{T}$. We can see that for every $2u_pfa(k)$ denoted by $\mathcal{J}$ there exists a word $w$ such that it is either in $L(\mathcal{T})$ but not in $L(\mathcal{J})$ or it is in $L(\mathcal{J})$ but not in $L(\mathcal{T})$, namely -- $\mathcal{J}$'s ``specification".
\end{proof}

Similarly as in \citep{Macarie1995} and \citep{Monien1980} in following proofs we will use the function
\[
	f_k : \left\{ 1^{2^n} | n \in \mathbb{N} \right\} \rightarrow \left\{ 1^{2^n} | n \in \mathbb{N} \right\} \textrm{, where } f_k( 1^{2^n}) = 1^{2^{k \cdot n}}
\]




\begin{lemma} \label{skaititaji}
For every language $L \in \widehat{U_pTM}$ there exists a natural number $u$ such that
\[
	f_u(L) \in \widehat{2U_pFA(3)}.
\]
\end{lemma}
\begin{proof}
We will show how a $u_ptm$ denoted by $\mathcal{T}$ which recognizes $L$ can be transformed into a $u_ptm$ called $\mathcal{T'}$ which can then be replaced by a $p$-ultrametric $3$ register machine from which it easily follows that there exists a $2u_pfa(k)$ which recognizes a ``stretched" variant of $L$ where the stretching operation is done by $f_u$.

We will construct $\mathcal{T'}$ so that it simulates $\mathcal{T}$. $\mathcal{T'}$ will hold the following information on its work tape:
\begin{itemize}
	\item the binary information of the input word,
	\item $\mathcal{T}$ head position on the 1st tape (we will call it the input tape),
	\item $\mathcal{T}$ 2nd tape contents (we will call it the work tape) (requires $O(log n)$ space),
	\item $\mathcal{T}$ head position on the work tape.
\end{itemize}
The simulation of $\mathcal{T}$ on $\mathcal{T'}$'s work tape is less complicated than in the case of ultrametric automata since $\mathcal{T'}$ can use the original finite control of $\mathcal{T}$ and the transitions are not required to be simulated on the tape. To simulate $\mathcal{T}$ $\mathcal{T'}$ uses only the work tape.

We can see that given $\mathcal{T'}$ a corresponding $p$-ultrametric $3$ register machine can be built. If the input is of the form $1^{2n}$ then the register machine starts with $n$ binary representation in the first register and with $0$ in the rest. The contents of $\mathcal{T'}$ work tape can be simulated by manipulating the registers of which the first two store sub-words $v$ and $h^{rev}$ and the third is used as helping register. To do this we use operations ``add $1$" and "divide by 2" which can be carried out by using the helping register. A schematic representation can be seen in Figure \ref{fig:skaititaji}.

\vspace{-8mm}
\begin{figure}[h!]
\centering
\includegraphics[width=0.8\textwidth]{Img/skaititaji.pdf}
\vspace{-5mm}
\caption{Simulating the contents of a Turing machine with registers.}
\label{fig:skaititaji}
\end{figure}

\vspace{-7mm}
Since a position of a multi-head automaton directly corresponds to a number in a register and the simulated Turing machine is with $log$-space space complexity then a $3$ register machine can be replaced with a $p$-ultrametric $3$ head automaton. But since its heads cannot cross word boundaries and therefore cannot simulate arbitrarily large numbers the input words must be long enough. This is achieved by choosing a large enough $u$.
\end{proof}










\begin{lemma} \label{reizinajums}
For all languages $L \in \widehat{U_pTM}$ and all $u, v \geq 1, u, v \in \mathbb{N}$:
\[
	f_u(L) \in \widehat{2U_pFA(v)} \Rightarrow L \in \widehat{2U_pFA(u \cdot v)}.
\]
\end{lemma}
\begin{proof}
Let the $2u_pfa(v)$ in the premise be $\mathcal{A}$ and the $2u_pfa(u \cdot v)$ in the conclusion -- $\mathcal{A'}$.

Consider the operation of $\mathcal{A}$ on a word $f_u(l), l = 1^{2^n} \in L, n \in \mathbb{N}$.
The position of each of $v$ heads of $\mathcal{A}$ on the input word can be described with an integer $h_i \in \left[0, 2^{u \cdot n} -1 \right]$.
$h_i$ can be written in base $2^n$ with $u$ digits.
As the position of each head of $\mathcal{A'}$ can be described with a digit in base $2^n$, each head of $\mathcal{A}$ can be simulated with $u$ heads of $\mathcal{A'}$.
As each movement of a head of $\mathcal{A}$ corresponds to movement of heads of $\mathcal{A'}$, the respective transitions can be done with equal amplitudes and the accepting amplitudes of the words remain the same.

Note that this simulation is done analogously as for deterministic automata in \citep{Monien1980} and for probabilistic automata in \citep{Macarie1995}.
\qed
\end{proof}

\begin{lemma} \label{plus1}
For every language $L \in \widehat{U_pTM}$ and every $u > v > 1, u, v \in \mathbb{N}$:
\[
	f_{u+1}(L) \in \widehat{2U_pFA(v)} \Rightarrow f_u(L) \in \widehat{U_pFA(v + 1)}.
\]
\end{lemma}
\begin{proof}
Let the $2u_pfa(v)$ in the premise be $\mathcal{A}$ and the $2u_pfa(v + 1)$ in the conclusion -- $\mathcal{A'}$.

Consider the operation of $\mathcal{A}$ on a word $f_{u+1}(l), l = 1^{2^n} \in L, n \in \mathbb{N}$.

The position of each of $v$ heads of $\mathcal{A}$ on the input word can be described with an integer $h_i \in \left[0, 2^{(u + 1) \cdot n} + 1 \right]$.

We will simulate the position $h_i$ in the automaton $\mathcal{A'}$ with a head $g_i$ and an additional number $x_i \in \left[ 0, 2^n \right]$ so that $h_i = g_i + x_i \cdot 2^{u \cdot n}$.
It is evident that numbers in the necessary interval can be denoted this way:
%\begin{align*}
\[
	2^{u \cdot n} + (2^n - 1) \cdot 2^{u \cdot n} =
	2^{u \cdot n} \cdot (1 + (2^n - 1)) =
	2^{u \cdot n + n} =
	2^{(u + 1) \cdot n}.
\]
%\end{align*}
All $v$ numbers $x_i$ are coded with the $(v+1)$-th head of $\mathcal{A'}$ similarly as in \citep{Monien1980}. %TODO siikaak aprakstiit
It can be done if on the tape of $\mathcal{A'}$ is enough space, specifically if $(2^n)^v < 2^{u \cdot n}$, which holds as $v < u$.

Again as each movement of a head of $\mathcal{A}$ corresponds to movement of heads of $\mathcal{A'}$, the respective transitions can be done with equal amplitudes and the accepting amplitudes of the words remain the same.

Note that this simulation again is done analogously as for deterministic automata in \citep{Monien1980} and for probabilistic automata in \citep{Macarie1995}.
%TODO atkaartojas teksts no ieprieksheejaas lemmas, varbuut paarrakstiit
\qed
\end{proof}

The result about the superiority of $k+1$ head over $k$ heads follows from the previous lemmas and Theorem \ref{atdalisana}.

\begin{theorem}
For all $k \geq 2 \in \mathbb{N}$
\[
	\widehat{2U_pFA(k)} \subsetneqq \widehat{2U_pFA(k + 1)}.
\]
\end{theorem}
\begin{proof}
We prove from the contrary by showing that if there exists such $h \geq 2$ that $\widehat{2U_pFA(h)} = \widehat{2U_pFA(h + 1)}$ it implies $\widehat{2U_pFA(h \cdot (h + 1))} = \widehat{U_pTM}$ which contradicts \ref{atdalisana}.

Take $L \in \widehat{U_pTM}$ for some prime $p$. Lemma \ref{skaititaji} implies that there exists $m \in \mathbb{N}$ such that $f_m(L) \in \widehat{2U_pFA(3)}$. Consequently $f_m(L) \in \widehat{2U_pFA(h)}$. Lemma \ref{plus1} implies that if $m > h + 1$ then $f_{m-1}(L) \in \widehat{2U_pFA(h + 1)} = \widehat{2U_pFA(h)}$. Take $m = m - 1$ and repeat while we get $f_m(L) \in \widehat{2U_pFA(h)}$ and $m = h + 1$. Then Lemma \ref{reizinajums} implies that if $f_m(L) \in \widehat{2U_pFA(h)}$ then $L \in \widehat{2U_pFA(h \cdot m)} = \widehat{2U_pFA(h \cdot (h + 1))}$. Which contradicts Theorem \ref{atdalisana}. \qed
\end{proof}
\begin{corollary}
Since $2U_pFA(k + 1)$ is a superset of $2U_pFA(k)$ and we proved that there exists a language that can be recognized with $k+1$ heads and not by $k$ then the head hierarchy result holds for languages in multi-letter alphabets as well:
\[
	2U_pFA(k) \subsetneqq 2U_pFA(k + 1).
\]
\end{corollary}


%\printbibliography
\bibliography{bibliography}{}
\bibliographystyle{abbrvnat}




\end{document}
